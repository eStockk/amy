# Minecraft <-> Website integration

Этот файл описывает контракт для плагина сервера, который будет выдавать код верификации после кика и синхронизировать RP-имя с сайтом.

## Авторизация запросов от сервера

Все серверные запросы должны передавать заголовок:

```http
X-Server-Token: <MINECRAFT_SERVER_TOKEN>
```

Токен задается в `.env` бэкенда.

---

## 1) Получить код верификации после кика

`POST /api/minecraft/verification-code`

Request body:

```json
{
  "nickname": "PlayerNick"
}
```

Ответы:
- `200 OK` с кодом и временем истечения:

```json
{
  "code": "A4K8M2Q9",
  "expiresAt": "2026-02-13T18:22:00Z"
}
```

- `200 OK` если уже верифицирован:

```json
{
  "alreadyVerified": true
}
```

- `404` если для ника нет одобренной RP-заявки.

### Логика на сервере
1. Игрок входит.
2. Если не в вайтлисте/не верифицирован на сайте - запросить код этим методом.
3. Кикнуть игрока с текстом: "Введите код <CODE> на сайте в профиле".

---

## 2) Пользователь вводит код на сайте

Сайт вызывает:

`POST /api/auth/verify-minecraft`

```json
{
  "code": "A4K8M2Q9"
}
```

Если код валиден и принадлежит авторизованному пользователю, аккаунт связывается с ником (`linkedMinecraft`).

---

## 3) Синхронизация MineRP имени и фамилии

После того как игрок в MineRP указал имя/фамилию, плагин отправляет:

`POST /api/minecraft/rp-name`

```json
{
  "nickname": "PlayerNick",
  "firstName": "Итан",
  "lastName": "Брукс"
}
```

Сайт обновит профиль пользователя (поля `rpFirstName`, `rpLastName`) по связанному нику.

---

## 4) RP-заявки и модерация

Пользователь отправляет RP-заявку через сайт:
- `POST /api/rp/applications`

Сайт отправляет заявку в Discord webhook (`DISCORD_RP_WEBHOOK`) с двумя кнопками-ссылками:
- Approve
- Reject

Кнопки открывают модерацию:
- `GET /api/rp/applications/{id}/moderate?action=approve|reject&token=...`

После `approve` ник становится доступным для шага выдачи кода верификации.


## ???????? RP-?????? ?????????????

?????????????? ???????????? ????? ??????? ???? ?????:

`DELETE /api/rp/applications/{id}`

?????? ??????? ?????? ?? MongoDB ? ??????? ??????????????? ????????? ?????? ?? Discord webhook-?????? (???? ????? ??? ?????? ????? ????????? ???????? `discordMessageId`).
